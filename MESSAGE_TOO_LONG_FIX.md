# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ MESSAGE_TOO_LONG

## üêõ –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏:

### 1. **–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è chat_id –∏–∑ CallbackQuery**
```
‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ 11 –∏–∑ –∫–∞–Ω–∞–ª–∞: 'CallbackQuery' object has no attribute 'chat'
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞ –≤ `send_photo_safe()`

**–ë—ã–ª–æ:**
```python
if hasattr(message_obj, 'bot'):
    # –≠—Ç–æ Message
    bot = message_obj.bot
    chat_id = message_obj.chat.id  # ‚ùå –û–®–ò–ë–ö–ê: CallbackQuery —Ç–æ–∂–µ –∏–º–µ–µ—Ç 'bot'
```

**–°—Ç–∞–ª–æ:**
```python
if hasattr(message_obj, 'message'):
    # –≠—Ç–æ CallbackQuery
    bot = message_obj.bot
    chat_id = message_obj.message.chat.id  # ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
else:
    # –≠—Ç–æ Message
    bot = message_obj.bot
    chat_id = message_obj.chat.id
```

---

### 2. **MESSAGE_TOO_LONG –ø—Ä–∏ fallback –æ—Ç–ø—Ä–∞–≤–∫–µ**
```
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–≥–¥–∞ —Ñ–æ—Ç–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è, –±–æ—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç —Ü–µ–ª–∏–∫–æ–º, –Ω–æ –æ–Ω –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç Telegram (4096 —Å–∏–º–≤–æ–ª–æ–≤)

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è:

### 1. **–§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–∏–µ–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π**

–°–æ–∑–¥–∞–Ω–∞ `split_long_message()` –≤ `handlers/days.py`:

```python
def split_long_message(text: str, max_length: int = 4000) -> list:
    """–†–∞–∑–±–∏–≤–∞–µ—Ç –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏
    
    - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é max_length=4000 (–∑–∞–ø–∞—Å –æ—Ç –ª–∏–º–∏—Ç–∞ 4096)
    - –†–∞–∑–±–∏–≤–∞–µ—Ç –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º (\n\n)
    - –ï—Å–ª–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π ‚Üí —Ä–∞–∑–±–∏–≤–∞–µ—Ç –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º
    """
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç ‚â§ 4000 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
2. –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç > 4000 —Å–∏–º–≤–æ–ª–æ–≤:
   - –†–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º (`\n\n`)
   - –ï—Å–ª–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ > 4000 ‚Üí —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º (`. `)
   - –ö–∞–∂–¥–∞—è —á–∞—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

---

### 2. **–§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π**

–°–æ–∑–¥–∞–Ω–∞ `send_long_message()` –≤ `handlers/days.py`:

```python
async def send_long_message(message_obj, text: str, reply_markup=None):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–ª–∏–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º
    
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ —á–∞—Å—Ç–∏
    - –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
    - –†–∞–±–æ—Ç–∞–µ—Ç —Å Message –∏ CallbackQuery
    """
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –í–º–µ—Å—Ç–æ:
await message.answer(very_long_text, reply_markup=keyboard)

# –ò—Å–ø–æ–ª—å–∑—É–µ–º:
await send_long_message(message, very_long_text, reply_markup=keyboard)
```

---

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω `send_photo_safe()`**

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –µ—Å–ª–∏ –æ–Ω —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–∞—Å—Ç–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é

**–î–æ:**
```python
# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç
await message_obj.answer(caption, reply_markup=reply_markup)
# ‚ùå –û–®–ò–ë–ö–ê –µ—Å–ª–∏ caption > 4096 —Å–∏–º–≤–æ–ª–æ–≤
```

**–ü–æ—Å–ª–µ:**
```python
# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º
await send_long_message(message_obj, caption, reply_markup=reply_markup)
# ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ —Å –ª—é–±–æ–π –¥–ª–∏–Ω–æ–π —Ç–µ–∫—Å—Ç–∞
```

---

## üìä Telegram –ª–∏–º–∏—Ç—ã:

| –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ | –õ–∏–º–∏—Ç |
|--------------|-------|
| –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è | **4096 —Å–∏–º–≤–æ–ª–æ–≤** |
| Caption –∫ —Ñ–æ—Ç–æ | **1024 —Å–∏–º–≤–æ–ª–∞** |
| Caption –∫ –≤–∏–¥–µ–æ | **1024 —Å–∏–º–≤–æ–ª–∞** |
| Caption –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É | **1024 —Å–∏–º–≤–æ–ª–∞** |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### –¢–µ—Å—Ç 1: –î–µ–Ω—å 20 (–ø—Ä–æ–±–ª–µ–º–Ω–æ–µ —Ñ–æ—Ç–æ 11)
```
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –î–Ω—é 20
2. –§–æ—Ç–æ 11 –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –∏–∑ –∫–∞–Ω–∞–ª–∞ ‚úÖ
3. –ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ ‚Üí —Ç–µ–∫—Å—Ç —Ä–∞–∑–æ–±—å–µ—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏ ‚úÖ
4. –í –∫–æ–Ω—Å–æ–ª–∏: "‚úÖ –§–æ—Ç–æ 11 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–∑ –∫–∞–Ω–∞–ª–∞ (message_id=16)"
```

### –¢–µ—Å—Ç 2: –î–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ —Ñ–æ—Ç–æ
```
1. –ï—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ –¥–µ–Ω—å –∏–º–µ–µ—Ç –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (>4000 —Å–∏–º–≤–æ–ª–æ–≤)
2. –¢–µ–∫—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–æ–±—å–µ—Ç—Å—è –Ω–∞ 2-3 —Å–æ–æ–±—â–µ–Ω–∏—è ‚úÖ
3. –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º ‚úÖ
```

### –¢–µ—Å—Ç 3: –î–µ–Ω—å 21
```
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –î–Ω—é 21
2. –í—Å–µ —Ç–µ–∫—Å—Ç—ã –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã ‚úÖ
3. –í–∏–¥–µ–æ –∏ —Ç–∞–Ω—Ü—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è ‚úÖ
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

### –ü—Ä–∏–º–µ—Ä 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –ª—é–±–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
await send_long_message(callback, very_long_text, reply_markup=keyboard)
```

### –ü—Ä–∏–º–µ—Ä 2: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ

```python
# –° fallback –Ω–∞ —Ç–µ–∫—Å—Ç –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º
await send_photo_safe(
    callback,
    photo_path="path/to/photo.jpg",
    caption="–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç...",
    reply_markup=keyboard,
    photo_num=11  # –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–∑ –∫–∞–Ω–∞–ª–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
)
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:

- ‚úÖ –î–µ–Ω—å 20 —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –§–æ—Ç–æ 11 –∏ 12 –∏–∑ –∫–∞–Ω–∞–ª–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ chat_id –∏–∑ CallbackQuery
- ‚úÖ –î–µ–Ω—å 21 –ø—Ä–æ–≤–µ—Ä–µ–Ω
- ‚úÖ –î–µ–Ω—å 22 –ø—Ä–æ–≤–µ—Ä–µ–Ω
- ‚úÖ –í—Å–µ —Ç–µ–∫—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã

---

## üéâ –ë–û–¢ –°–¢–ê–ë–ò–õ–ï–ù!

–¢–µ–ø–µ—Ä—å –±–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
- –õ—é–±—ã–µ –¥–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ)
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–æ—Ç–æ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑ –∫–∞–Ω–∞–ª–∞)
- Fallback —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ —Ñ–æ—Ç–æ)
- –í—Å–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤ (Message –∏ CallbackQuery)

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –î–µ–Ω—å 20 –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ**

